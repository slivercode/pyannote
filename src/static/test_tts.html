<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTSæµ‹è¯•é¡µé¢</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            background: #2a2a2a;
            padding: 30px;
            border-radius: 10px;
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #444;
            background: #333;
            color: #fff;
        }
        button {
            background: #7c3aed;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #6d28d9;
        }
        .log {
            background: #1a1a1a;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ GPT-SoVITS TTS æµ‹è¯•</h1>
        
        <div>
            <label>APIåœ°å€:</label>
            <input type="text" id="apiUrl" value="http://192.168.110.204:9880/tts">
        </div>
        
        <div>
            <label>å‚è€ƒéŸ³é¢‘è·¯å¾„:</label>
            <input type="text" id="refAudioPath" value="cs3.mp3" placeholder="cs3.mp3">
        </div>
        
        <div>
            <label>å‚è€ƒæ–‡æœ¬:</label>
            <input type="text" id="promptText" value="ä½•ã§ã ã‚ˆ ç§ãŸã¡ã¯æ²»ç™‚ã‚’å—ã‘ã«æ¥ãŸã‚“ã ã‚ˆ ãã†ã ã‚ˆ ã“ã“ã¯ãŠå‰ã®å®¶ã˜ã‚ƒãªã„ã ã‚">
        </div>
        
        <div>
            <label>å‚è€ƒè¯­è¨€:</label>
            <select id="promptLang" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #444; background: #333; color: #fff;">
                <option value="zh">ä¸­æ–‡</option>
                <option value="en">è‹±æ–‡</option>
                <option value="ja" selected>æ—¥æ–‡</option>
            </select>
        </div>
        
        <div>
            <label>æµ‹è¯•æ–‡æœ¬:</label>
            <input type="text" id="testText" value="ä½ å¥½ï¼Œè¿™æ˜¯æµ‹è¯•æ–‡æœ¬">
        </div>
        
        <button onclick="testTTS()">ğŸš€ å¼€å§‹æµ‹è¯•</button>
        
        <div class="log" id="log"></div>
        
        <audio id="audioPlayer" controls style="width: 100%; margin-top: 20px; display: none;"></audio>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        async function testTTS() {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = '';
            
            const apiUrl = document.getElementById('apiUrl').value;
            const refAudioPath = document.getElementById('refAudioPath').value;
            const promptText = document.getElementById('promptText').value;
            const promptLang = document.getElementById('promptLang').value;
            const testText = document.getElementById('testText').value;

            log('ğŸ“‹ æµ‹è¯•å‚æ•°:', 'info');
            log(`  APIåœ°å€: ${apiUrl}`, 'info');
            log(`  å‚è€ƒéŸ³é¢‘: ${refAudioPath}`, 'info');
            log(`  å‚è€ƒæ–‡æœ¬: ${promptText}`, 'info');
            log(`  å‚è€ƒè¯­è¨€: ${promptLang}`, 'info');
            log(`  æµ‹è¯•æ–‡æœ¬: ${testText}`, 'info');
            log('', 'info');

            const params = {
                text: testText,
                text_lang: 'zh',
                ref_audio_path: refAudioPath,
                prompt_text: promptText,
                prompt_lang: promptLang,
                speed_factor: 1.0
            };

            log('ğŸ”„ å‘é€è¯·æ±‚...', 'info');
            
            try {
                const response = await axios.get(apiUrl, {
                    params: params,
                    responseType: 'blob',
                    timeout: 30000
                });

                log('âœ… è¯·æ±‚æˆåŠŸ!', 'success');
                log(`  çŠ¶æ€ç : ${response.status}`, 'success');
                log(`  Content-Type: ${response.headers['content-type']}`, 'success');
                log(`  æ•°æ®å¤§å°: ${response.data.size} å­—èŠ‚`, 'success');
                log('', 'info');

                const contentType = response.headers['content-type'];
                
                if (contentType && contentType.includes('audio')) {
                    log('ğŸµ æ£€æµ‹åˆ°éŸ³é¢‘æ•°æ®ï¼Œåˆ›å»ºæ’­æ”¾å™¨...', 'success');
                    
                    const audioBlob = new Blob([response.data], { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    const audioPlayer = document.getElementById('audioPlayer');
                    audioPlayer.src = audioUrl;
                    audioPlayer.style.display = 'block';
                    
                    log('â–¶ï¸ å¼€å§‹æ’­æ”¾...', 'success');
                    audioPlayer.play().then(() => {
                        log('âœ… æ’­æ”¾æˆåŠŸ!', 'success');
                    }).catch(err => {
                        log(`âŒ æ’­æ”¾å¤±è´¥: ${err.message}`, 'error');
                    });
                } else {
                    log(`âš ï¸ è¿”å›çš„ä¸æ˜¯éŸ³é¢‘æ–‡ä»¶`, 'error');
                    log(`  Content-Type: ${contentType}`, 'error');
                    
                    // å°è¯•è¯»å–æ–‡æœ¬å†…å®¹
                    try {
                        const text = await response.data.text();
                        log(`  è¿”å›å†…å®¹: ${text.substring(0, 200)}`, 'error');
                    } catch (e) {
                        log(`  æ— æ³•è¯»å–è¿”å›å†…å®¹`, 'error');
                    }
                }

            } catch (err) {
                log('âŒ è¯·æ±‚å¤±è´¥!', 'error');
                log(`  é”™è¯¯ç±»å‹: ${err.name}`, 'error');
                log(`  é”™è¯¯ä¿¡æ¯: ${err.message}`, 'error');
                
                if (err.response) {
                    log(`  å“åº”çŠ¶æ€: ${err.response.status}`, 'error');
                    log(`  å“åº”çŠ¶æ€æ–‡æœ¬: ${err.response.statusText}`, 'error');
                    
                    try {
                        if (err.response.data instanceof Blob) {
                            const text = await err.response.data.text();
                            log(`  é”™è¯¯è¯¦æƒ…: ${text}`, 'error');
                        } else {
                            log(`  é”™è¯¯è¯¦æƒ…: ${JSON.stringify(err.response.data)}`, 'error');
                        }
                    } catch (e) {
                        log(`  æ— æ³•è§£æé”™è¯¯è¯¦æƒ…`, 'error');
                    }
                } else if (err.request) {
                    log('  è¯·æ±‚å·²å‘é€ä½†æœªæ”¶åˆ°å“åº”', 'error');
                    log('  å¯èƒ½åŸå› : æœåŠ¡å™¨æœªå¯åŠ¨ã€ç½‘ç»œé—®é¢˜ã€CORSé—®é¢˜', 'error');
                } else {
                    log(`  è¯·æ±‚é…ç½®é”™è¯¯: ${err.message}`, 'error');
                }
                
                console.error('å®Œæ•´é”™è¯¯å¯¹è±¡:', err);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„æç¤º
        window.onload = function() {
            log('âœ… æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
            log('ğŸ“ è¯·æ£€æŸ¥é…ç½®åç‚¹å‡»"å¼€å§‹æµ‹è¯•"æŒ‰é’®', 'info');
            log('', 'info');
        };
    </script>
</body>
</html>
