# 视频 OCR 字幕提取功能集成需求文档

## 简介

将 video-subtitle-extractor 项目的 OCR 字幕提取功能作为独立模块集成到 pyannote-audio-web-ui 中，为用户提供从视频中提取硬字幕并生成 SRT 文件的能力。该功能与现有的 TTS 配音、说话人分离等功能完全独立，互不影响。

## 术语表

- **OCR (Optical Character Recognition)**: 光学字符识别，从图像中识别文本的技术
- **硬字幕**: 直接嵌入在视频画面中的字幕，无法单独关闭
- **字幕区域**: 视频中字幕通常出现的区域范围
- **PaddleOCR**: 百度开源的 OCR 识别框架
- **SRT 文件**: SubRip 字幕文件格式，包含时间轴和文本内容
- **帧提取**: 从视频中提取关键帧进行 OCR 识别的过程

## 需求

### 需求 1

**用户故事:** 作为用户，我想要在独立的 OCR 字幕提取页面上传包含硬字幕的视频文件，以便提取其中的字幕文本并生成 SRT 文件。

#### 验收标准

1. WHEN 用户访问独立的 OCR 字幕提取页面 THEN 系统 SHALL 显示专用的视频文件上传界面
2. WHEN 用户上传视频文件 THEN 系统 SHALL 验证文件格式并显示视频预览
3. WHEN 视频文件格式不支持 THEN 系统 SHALL 显示错误提示信息
4. WHEN 视频文件过大（超过500MB）THEN 系统 SHALL 显示文件大小限制提示
5. WHEN 视频上传成功 THEN 系统 SHALL 显示视频基本信息（时长、分辨率、帧率）

### 需求 2

**用户故事:** 作为用户，我想要选择视频中的字幕区域，以便提高 OCR 识别的准确性和效率。

#### 验收标准

1. WHEN 视频上传成功 THEN 系统 SHALL 显示视频预览画面和字幕区域选择工具
2. WHEN 用户拖拽选择字幕区域 THEN 系统 SHALL 实时显示选择框的坐标和尺寸
3. WHEN 用户调整字幕区域 THEN 系统 SHALL 保存区域坐标供后续处理使用
4. WHEN 用户未选择字幕区域 THEN 系统 SHALL 使用默认的下方字幕区域
5. WHEN 字幕区域超出视频边界 THEN 系统 SHALL 自动调整到有效范围内

### 需求 3

**用户故事:** 作为用户，我想要配置 OCR 识别参数，以便根据视频内容选择最适合的识别模式和语言。

#### 验收标准

1. WHEN 用户进入配置界面 THEN 系统 SHALL 显示语言选择下拉菜单（支持中文、英文、日文等87种语言）
2. WHEN 用户选择识别模式 THEN 系统 SHALL 提供快速、自动、精准三种模式选项
3. WHEN 系统检测到 GPU THEN 系统 SHALL 自动启用 GPU 加速并显示提示信息
4. WHEN 用户选择精准模式 THEN 系统 SHALL 显示处理时间较长的警告提示
5. WHEN 用户修改配置 THEN 系统 SHALL 保存配置供下次使用

### 需求 4

**用户故事:** 作为用户，我想要启动 OCR 字幕提取过程，以便从视频中识别并提取字幕文本。

#### 验收标准

1. WHEN 用户点击开始提取按钮 THEN 系统 SHALL 初始化 OCR 模型并开始处理
2. WHEN OCR 处理开始 THEN 系统 SHALL 显示实时进度条和当前处理状态
3. WHEN 系统提取视频帧 THEN 系统 SHALL 更新帧提取进度（0-50%）
4. WHEN 系统进行 OCR 识别 THEN 系统 SHALL 更新 OCR 识别进度（50-100%）
5. WHEN 处理过程中出现错误 THEN 系统 SHALL 显示具体错误信息并允许重试

### 需求 5

**用户故事:** 作为用户，我想要查看和编辑提取的字幕内容，以便修正识别错误并优化字幕质量。

#### 验收标准

1. WHEN OCR 提取完成 THEN 系统 SHALL 显示提取的字幕列表和预览界面
2. WHEN 用户查看字幕列表 THEN 系统 SHALL 显示每条字幕的时间轴、文本内容和置信度
3. WHEN 用户点击编辑字幕 THEN 系统 SHALL 提供文本编辑功能
4. WHEN 用户修改字幕文本 THEN 系统 SHALL 实时保存修改内容
5. WHEN 用户删除字幕条目 THEN 系统 SHALL 从列表中移除该条目并重新排序

### 需求 6

**用户故事:** 作为用户，我想要导出生成的字幕文件，以便在其他播放器或编辑软件中使用。

#### 验收标准

1. WHEN 字幕提取和编辑完成 THEN 系统 SHALL 提供 SRT 文件下载功能
2. WHEN 用户点击下载 SRT THEN 系统 SHALL 生成标准格式的 SRT 文件
3. WHEN 用户选择导出 TXT THEN 系统 SHALL 生成纯文本格式的字幕文件
4. WHEN 导出文件 THEN 系统 SHALL 使用视频文件名作为字幕文件名
5. WHEN 文件导出成功 THEN 系统 SHALL 显示下载链接和文件大小信息

### 需求 7

**用户故事:** 作为用户，我想要系统自动去除重复字幕和水印文本，以便获得更干净的字幕内容。

#### 验收标准

1. WHEN 系统检测到重复字幕 THEN 系统 SHALL 自动合并相同内容的连续字幕
2. WHEN 系统识别到疑似水印区域 THEN 系统 SHALL 标记并提供删除选项
3. WHEN 用户确认删除水印 THEN 系统 SHALL 从字幕列表中移除水印文本
4. WHEN 系统检测到非字幕区域文本 THEN 系统 SHALL 过滤掉场景中的无关文字
5. WHEN 字幕置信度低于阈值 THEN 系统 SHALL 标记低质量字幕供用户确认

### 需求 8

**用户故事:** 作为用户，我想要批量处理多个视频文件，以便提高工作效率。

#### 验收标准

1. WHEN 用户选择多个视频文件 THEN 系统 SHALL 支持批量上传和处理
2. WHEN 批量处理开始 THEN 系统 SHALL 显示每个文件的处理状态和总体进度
3. WHEN 单个文件处理完成 THEN 系统 SHALL 自动开始处理下一个文件
4. WHEN 批量处理中出现错误 THEN 系统 SHALL 跳过错误文件并继续处理其他文件
5. WHEN 所有文件处理完成 THEN 系统 SHALL 提供批量下载所有 SRT 文件的功能

### 需求 9

**用户故事:** 作为系统管理员，我想要监控 OCR 处理的性能和资源使用情况，以便优化系统配置。

#### 验收标准

1. WHEN OCR 处理运行时 THEN 系统 SHALL 记录 CPU 和内存使用情况
2. WHEN 使用 GPU 加速时 THEN 系统 SHALL 监控 GPU 内存和利用率
3. WHEN 处理大文件时 THEN 系统 SHALL 限制并发处理数量以避免资源耗尽
4. WHEN 系统资源不足时 THEN 系统 SHALL 显示警告并建议降低处理质量
5. WHEN 处理完成时 THEN 系统 SHALL 记录处理时间和识别准确率统计信息

### 需求 10

**用户故事:** 作为用户，我想要 OCR 字幕提取功能与现有功能完全独立，以便可以单独使用而不影响其他模块。

#### 验收标准

1. WHEN 用户使用 OCR 字幕提取功能 THEN 系统 SHALL 不影响 TTS 配音功能的正常运行
2. WHEN 用户使用 OCR 字幕提取功能 THEN 系统 SHALL 不影响说话人分离功能的正常运行
3. WHEN OCR 模块处理视频时 THEN 系统 SHALL 使用独立的临时目录和缓存空间
4. WHEN OCR 模块出现错误时 THEN 系统 SHALL 不影响其他功能模块的稳定性
5. WHEN 用户在不同功能模块间切换时 THEN 系统 SHALL 保持各模块的独立状态和数据隔离