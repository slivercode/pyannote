# 导出更新后的字幕功能说明

## 🎯 功能概述

现在在导出配音音频的同时，会自动提供更新后的字幕SRT文件。

## 📝 什么时候会生成更新后的字幕？

### 1. 启用"智能音频加速"时

当你启用了"智能音频加速"功能时，系统会：
- 调整字幕时间轴
- 加速音频以匹配字幕
- 生成 `updated_subtitles.srt` 文件

### 2. 启用"保持SRT总时长不变"时

当你启用了"保持SRT总时长不变"功能时，系统会：
- 动态调整字幕时间轴
- 确保最终时长 = 原始SRT总时长
- 生成 `updated_subtitles.srt` 文件

### 3. 不生成更新后字幕的情况

如果你使用传统方式（不启用智能加速），则不会生成更新后的字幕文件。

## 🎨 界面显示

### 配音完成后

```
┌─────────────────────────────────────┐
│ ✅ 配音完成                          │
├─────────────────────────────────────┤
│ [音频播放器]                         │
│                                     │
│ [下载音频] [下载字幕] [打开文件夹]   │
│                                     │
│ 🎵 音频: /path/to/dubbing_result.wav│
│ 📄 字幕: /path/to/updated_subtitles.srt│
└─────────────────────────────────────┘
```

- **下载音频**：绿色按钮，下载配音音频文件
- **下载字幕**：紫色按钮，下载更新后的字幕文件（如果有）
- **打开文件夹**：蓝色按钮，打开输出文件夹

## 📊 API响应格式

```json
{
  "task_id": "xxx",
  "status": "completed",
  "progress": 100,
  "result_path": "/path/to/dubbing_result.wav",
  "srt_path": "/path/to/updated_subtitles.srt"
}
```

- `result_path`: 配音音频文件路径
- `srt_path`: 更新后的字幕文件路径（可能为 null）

## 🔧 技术实现

### 后端修改

1. **TTSDubbingProcessor.process()** 返回字典：
   ```python
   return {
       'audio_path': str,  # 音频文件路径
       'srt_path': str or None  # 字幕文件路径
   }
   ```

2. **API响应** 包含 `srt_path` 字段

### 前端修改

1. **保存SRT路径**：
   ```javascript
   if (res.data.srt_path) {
     ttsDubbing.value.srtPath = res.data.srt_path;
     ttsDubbing.value.srtUrl = getEnhanceFileUrl(res.data.srt_path);
   }
   ```

2. **显示下载按钮**：
   ```html
   <a v-if="ttsDubbing.srtUrl" :href="ttsDubbing.srtUrl" download>
     下载字幕
   </a>
   ```

## ✅ 使用示例

### 场景：日语配音 + 保持总时长

1. 上传中文SRT文件（1:55）
2. 选择日语配音
3. 启用"智能音频加速"
4. 启用"保持SRT总时长不变"
5. 点击"开始配音"

**输出**：
- `dubbing_result.wav` - 配音音频（1:55）
- `updated_subtitles.srt` - 更新后的字幕（1:55）

**更新后的字幕内容**：
```srt
1
00:00:00,000 --> 00:00:02,250
こんにちは

2
00:00:02,250 --> 00:00:05,625
今日はいい天気ですね

3
00:00:05,625 --> 00:00:09,000
散歩に行きましょう
```

时间轴已经调整，确保总时长 = 原始SRT总时长。
