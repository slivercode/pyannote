# TTS 配音模块使用说明

## 📋 功能概述

TTS 配音模块可以根据 SRT 字幕文件自动生成配音，支持：
- ✅ 上传 SRT 字幕文件
- ✅ 选择 TTS 引擎（GPT-SoVITS / QwenTTS）
- ✅ 选择配音角色
- ✅ 自动按时间轴对齐
- ✅ 实时进度显示
- ✅ 在线试听和下载

## 🚀 快速开始

### 步骤1: 准备 SRT 字幕文件

创建或准备一个标准的 SRT 字幕文件，格式如下：

```srt
1
00:00:00,000 --> 00:00:05,000
大家好，欢迎收看今天的节目

2
00:00:05,500 --> 00:00:10,000
今天我们要讲解的是人工智能技术

3
00:00:10,500 --> 00:00:15,000
让我们开始吧
```

### 步骤2: 配置 TTS 模型

1. 点击导航栏的 **"TTS模型管理"**
2. 启用 **GPT-SoVITS**
3. 填写 API 地址：`http://192.168.110.204:9880`
4. 添加配音角色：
   - 角色名称：`主播`
   - 参考音频：`host.wav`
   - 参考文本：`大家好，欢迎收看`
   - 参考语言：`中文`
   - 语速：`1.0`
5. 点击 **"测试合成"** 确认配置正确
6. 点击 **"保存配置"**

### 步骤3: 开始配音

1. 点击导航栏的 **"TTS配音"**
2. 上传 SRT 字幕文件
3. 选择 TTS 引擎：`GPT-SoVITS`
4. 选择配音角色：`主播`
5. 调整参数（可选）：
   - 语速：`1.0x`
   - 静音间隔：`0.5秒`
   - 自动对齐时间轴：`✓`
6. 点击 **"开始配音"**

### 步骤4: 等待完成

- 实时查看配音进度
- 查看当前处理的字幕
- 等待所有字幕合成完成

### 步骤5: 下载结果

- 在线试听配音结果
- 点击 **"下载音频"** 保存文件
- 点击 **"打开文件夹"** 查看输出目录

## 📊 功能详解

### SRT 文件要求

**格式规范**:
```
序号
开始时间 --> 结束时间
字幕文本

序号
开始时间 --> 结束时间
字幕文本
```

**时间格式**: `HH:MM:SS,mmm`
- `HH`: 小时 (00-23)
- `MM`: 分钟 (00-59)
- `SS`: 秒 (00-59)
- `mmm`: 毫秒 (000-999)

**示例**:
```srt
1
00:00:00,000 --> 00:00:03,500
这是第一句话

2
00:00:04,000 --> 00:00:08,000
这是第二句话
```

### TTS 引擎选择

#### GPT-SoVITS
- ✅ 支持多语言（中文、英文、日文）
- ✅ 音质自然，接近真人
- ✅ 可自定义参考音频
- ⚠️ 需要部署 GPT-SoVITS 服务

**配置要求**:
- API 地址：GPT-SoVITS 服务地址
- 参考音频：3-10秒的清晰音频
- 参考文本：与参考音频内容一致
- 参考语言：音频的语言

#### QwenTTS（开发中）
- ✅ 云端服务，无需部署
- ✅ 多种预设音色
- ⚠️ 需要 API 密钥

### 高级选项

#### 语速调整
- **范围**: 0.5x - 2.0x
- **默认**: 1.0x
- **说明**: 
  - `< 1.0`: 放慢语速
  - `= 1.0`: 正常语速
  - `> 1.0`: 加快语速

#### 静音间隔
- **范围**: 0 - 5 秒
- **默认**: 0.5 秒
- **说明**: 字幕之间的停顿时间

#### 自动对齐时间轴
- **启用**: 自动调整音频长度以匹配字幕时长
- **禁用**: 保持原始合成音频长度
- **推荐**: 启用（确保配音与字幕同步）

## 🎯 使用场景

### 场景1: 视频配音

**需求**: 为无声视频添加配音

**步骤**:
1. 使用 OCR 或手动创建 SRT 字幕
2. 上传 SRT 文件到 TTS 配音模块
3. 选择合适的配音角色
4. 生成配音音频
5. 使用视频编辑软件合并音频和视频

### 场景2: 有声书制作

**需求**: 将文本转换为有声读物

**步骤**:
1. 将文本分段，创建 SRT 文件
2. 选择朗读风格的配音角色
3. 调整语速和停顿
4. 生成完整的有声音频

### 场景3: 多语言配音

**需求**: 为同一视频制作多语言版本

**步骤**:
1. 准备不同语言的 SRT 字幕
2. 为每种语言配置对应的 TTS 角色
3. 分别生成各语言的配音
4. 制作多语言版本视频

### 场景4: 教学视频制作

**需求**: 快速制作教学视频配音

**步骤**:
1. 编写教学脚本，转换为 SRT 格式
2. 选择教师风格的配音角色
3. 设置适当的语速（建议 0.9x - 1.0x）
4. 生成清晰的教学配音

## 🔧 故障排查

### 问题1: SRT 文件解析失败

**症状**: 上传后显示"SRT文件解析失败"

**原因**:
- 文件格式不正确
- 编码不是 UTF-8
- 时间格式错误

**解决**:
1. 检查 SRT 文件格式
2. 使用文本编辑器另存为 UTF-8 编码
3. 确认时间格式为 `HH:MM:SS,mmm`

### 问题2: 配音失败

**症状**: 任务状态显示"失败"

**原因**:
- TTS 服务未启动
- API 地址错误
- 参考音频文件不存在
- 网络连接问题

**解决**:
1. 确认 GPT-SoVITS 服务正在运行
2. 检查 API 地址是否正确
3. 确认参考音频文件在服务器根目录
4. 测试网络连接

### 问题3: 音频不同步

**症状**: 配音与字幕时间不匹配

**原因**:
- 未启用"自动对齐时间轴"
- 字幕时间轴设置不合理

**解决**:
1. 启用"自动对齐时间轴"选项
2. 检查 SRT 文件的时间设置
3. 调整静音间隔参数

### 问题4: 音质不佳

**症状**: 合成的语音听起来不自然

**原因**:
- 参考音频质量差
- 参考文本与音频不匹配
- 语速设置不当

**解决**:
1. 使用高质量的参考音频（清晰、无噪音）
2. 确保参考文本与音频内容完全一致
3. 调整语速到合适的值

## 💡 最佳实践

### 1. SRT 文件准备

**推荐**:
- ✅ 每句话 3-10 秒
- ✅ 句子完整，语义清晰
- ✅ 合理的停顿时间
- ✅ UTF-8 编码

**避免**:
- ❌ 过长的句子（> 20秒）
- ❌ 过短的句子（< 1秒）
- ❌ 时间重叠
- ❌ 特殊字符和表情符号

### 2. 角色配置

**参考音频**:
- 时长：3-10 秒
- 格式：WAV（推荐）或 MP3
- 质量：清晰、无噪音、无背景音乐
- 内容：完整的句子，发音清晰

**参考文本**:
- 与音频内容完全一致
- 包含标点符号
- 语言标记正确

### 3. 参数设置

**语速**:
- 新闻播报：1.0x - 1.1x
- 教学视频：0.9x - 1.0x
- 有声书：0.8x - 0.9x
- 广告配音：1.1x - 1.2x

**静音间隔**:
- 快节奏：0.3 - 0.5 秒
- 正常节奏：0.5 - 0.8 秒
- 慢节奏：0.8 - 1.2 秒

### 4. 质量检查

**配音完成后**:
1. ✅ 完整试听一遍
2. ✅ 检查音频同步
3. ✅ 确认发音准确
4. ✅ 验证音量一致

## 📈 性能优化

### 处理速度

**影响因素**:
- 字幕数量
- TTS 服务器性能
- 网络延迟
- 音频处理复杂度

**优化建议**:
1. 使用本地 TTS 服务（减少网络延迟）
2. 分批处理长字幕文件
3. 升级 TTS 服务器硬件

### 音质优化

**提升音质**:
1. 使用高质量参考音频
2. 选择合适的语速
3. 避免过度压缩
4. 后期音频处理（降噪、均衡）

## 🔗 相关文档

- [TTS模型管理使用说明.md](./TTS模型管理使用说明.md)
- [TTS配置持久化说明.md](./TTS配置持久化说明.md)
- [CORS问题解决方案.md](./CORS问题解决方案.md)

## 📞 技术支持

### 常见问题

**Q: 支持哪些语言？**
A: GPT-SoVITS 支持中文、英文、日文等多种语言，具体取决于参考音频。

**Q: 可以批量处理吗？**
A: 目前支持单个 SRT 文件处理，未来会添加批量处理功能。

**Q: 生成的音频格式是什么？**
A: 默认生成 WAV 格式，可以使用音频转换工具转换为其他格式。

**Q: 如何提高处理速度？**
A: 使用本地部署的 TTS 服务，减少网络延迟。

### 反馈渠道

如有问题或建议，请：
1. 查看浏览器控制台（F12）的错误信息
2. 检查后端日志
3. 参考相关文档
4. 联系技术支持

## ✅ 总结

TTS 配音模块提供了一个完整的自动配音解决方案：

1. **简单易用**: 上传 SRT，选择角色，一键生成
2. **高度可定制**: 支持多种参数调整
3. **实时反馈**: 进度显示，即时预览
4. **质量保证**: 自动对齐，音质优化

开始使用 TTS 配音模块，让配音制作变得简单高效！🎉
