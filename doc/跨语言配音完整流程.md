# 跨语言配音完整流程指南

## 快速开始（3步完成）

### 第1步：TTS配音（生成音频和调整后的字幕）

1. 进入"TTS配音"标签
2. 上传中文SRT字幕文件
3. 配置设置：
   ```
   ✅ 移除静音间隙：勾选
   ❌ 保持SRT总时长不变：不勾选
   语速：1.0x
   合成语言：日语
   ```
4. 点击"开始配音"
5. 获得输出：
   - `dubbing_result.wav`（日语配音，已移除静音）
   - `adjusted_subtitles.srt`（时间轴已拉伸）

### 第2步：视频合并（同步画面和音频）

1. 进入"视频合并"标签
2. 上传原始视频
3. 上传 `dubbing_result.wav`
4. 上传 `adjusted_subtitles.srt`
5. 选择"替换音轨并烧录字幕"
6. 点击"开始合并"

### 第3步：完成！

输出文件：`output/merged_video.mp4`
- 视频画面自动慢放以匹配音频
- 日语配音完美同步
- 字幕时间轴准确对齐

---

## 详细流程说明

### 问题背景

**典型场景**：
- 原始视频：85秒，中文字幕
- 日语配音：需要170秒（日语表达更长）
- 挑战：如何让画面、音频、字幕三者同步？

**传统方案的问题**：
1. 保持SRT总时长 → 日语被压缩 → 发音不清晰
2. 不保持总时长 → 大量静音间隙 → 配音不自然
3. 手动调整字幕 → 耗时费力 → 容易出错

**我们的解决方案**：
1. 移除静音间隙 → 日语自然生成
2. 自动拉伸字幕 → 时间轴匹配音频
3. 视频慢放 → 画面同步音频

---

## 第1步：TTS配音详解

### 界面操作

#### 单角色配音

```
┌─────────────────────────────────────┐
│ TTS配音 > 单角色配音                │
├─────────────────────────────────────┤
│ SRT字幕文件：[选择文件]             │
│ TTS引擎：GPT-SoVITS                 │
│ 配音角色：日语女声                  │
│ 合成语言：日语                      │
│ TTS生成语速：1.0x                   │
│                                     │
│ ☑ 移除静音间隙（推荐）              │
│   移除对话之间的静音间隙            │
│                                     │
│ ☐ 保持SRT总时长不变                │
│   不推荐用于跨语言配音              │
│                                     │
│ [开始配音]                          │
└─────────────────────────────────────┘
```

#### 多角色配音

```
┌─────────────────────────────────────┐
│ TTS配音 > 多角色配音                │
├─────────────────────────────────────┤
│ SRT字幕文件：[选择文件]             │
│ （需要包含[spk01]等说话人标记）     │
│                                     │
│ 角色配置：                          │
│ spk01: 日语女声A                    │
│ spk02: 日语男声B                    │
│                                     │
│ ☑ 移除静音间隙（推荐）              │
│ ☐ 保持SRT总时长不变                │
│                                     │
│ [开始配音]                          │
└─────────────────────────────────────┘
```

### 配置说明

| 选项 | 推荐设置 | 说明 |
|------|---------|------|
| 移除静音间隙 | ✅ 勾选 | 让日语自然生成，不受中文时间轴限制 |
| 保持SRT总时长 | ❌ 不勾选 | 避免压缩日语音频导致发音不清 |
| TTS生成语速 | 1.0x | 使用标准语速，让TTS自然表达 |
| 合成语言 | 日语 | 根据目标语言选择 |

### 输出文件

```
output/
├── dubbing_result.wav              # 日语配音（已移除静音）
│   └── 时长：170秒
│
└── adjusted_subtitles.srt          # 调整后的字幕
    └── 时长：170秒（从85秒拉伸而来）
```

### 日志示例

```
🎬 开始TTS配音处理...
📖 解析SRT文件: input.srt
✅ 解析成功，共 20 条字幕

🔄 生成配音...
✅ 字幕 1/20: こんにちは、ここへようこそ
✅ 字幕 2/20: 今日は新しい機能を紹介します
...

🔗 拼接音频片段（移除静音间隙）...
💾 导出最终音频: dubbing_result.wav

📊 移除静音间隙模式:
   实际音频时长: 170.00秒 (170000ms)

🎯 自动调整字幕时间轴（方案A）:
   原始字幕时长: 85.00秒 (85000ms)
   实际音频时长: 170.00秒 (170000ms)
   拉伸比例: 2.00x

✅ 字幕时间轴调整完成:
   调整后总时长: 170.00秒 (170000ms)
   与音频差异: 0ms
   保存位置: output/adjusted_subtitles.srt

✅ TTS配音完成！
```

---

## 第2步：视频合并详解

### 界面操作

```
┌─────────────────────────────────────┐
│ 视频合并                            │
├─────────────────────────────────────┤
│ 原始视频：[选择文件]                │
│   └── video.mp4 (85秒)              │
│                                     │
│ 音频文件：[选择文件]                │
│   └── dubbing_result.wav (170秒)   │
│                                     │
│ 字幕文件：[选择文件]                │
│   └── adjusted_subtitles.srt       │
│                                     │
│ 合并模式：                          │
│ ⦿ 替换音轨并烧录字幕                │
│ ○ 仅替换音轨                        │
│ ○ 混合音轨                          │
│                                     │
│ [开始合并]                          │
└─────────────────────────────────────┘
```

### 自动处理

系统会自动：
1. 检测视频时长（85秒）和音频时长（170秒）
2. 计算慢放比例：170 / 85 = 2.0x
3. 使用FFmpeg慢放视频：
   ```
   setpts=2.0*PTS
   fps=fps/2.0
   ```
4. 调整字幕时间轴以匹配慢放后的视频
5. 烧录字幕到视频

### 输出文件

```
output/
└── merged_video.mp4
    ├── 视频：170秒（慢放2倍）
    ├── 音频：170秒（日语配音）
    └── 字幕：已烧录，时间轴准确
```

### 日志示例

```
🎬 开始视频合并...
📊 媒体信息:
   视频时长: 85.00秒
   音频时长: 170.00秒
   字幕时长: 170.00秒

🎯 检测到音频比视频长，启用视频慢放同步
   慢放比例: 2.00x

🔧 调整字幕时间轴以匹配慢放后的视频
   原始字幕: 170秒
   调整后: 170秒（已匹配慢放视频）

🎬 执行FFmpeg合并...
   视频滤镜: setpts=2.0*PTS,fps=15
   字幕烧录: subtitles=adjusted_subtitles_slowdown.srt

✅ 视频合并完成！
   输出文件: output/merged_video.mp4
```

---

## 完整示例

### 输入文件

**input.srt**（中文字幕，85秒）：
```srt
1
00:00:00,000 --> 00:00:05,000
你好，欢迎来到这里

2
00:00:05,500 --> 00:00:10,000
今天我们要介绍一个新功能

...（共20条字幕）
```

**video.mp4**：
- 时长：85秒
- 分辨率：1920x1080
- 帧率：30fps

### 处理过程

#### 步骤1：TTS配音

**配置**：
- 移除静音间隙：✅
- 保持SRT总时长：❌
- 语速：1.0x
- 语言：日语

**输出**：
- `dubbing_result.wav`（170秒）
- `adjusted_subtitles.srt`（170秒）

**adjusted_subtitles.srt**：
```srt
1
00:00:00,000 --> 00:00:10,000
你好，欢迎来到这里

2
00:00:11,000 --> 00:00:20,000
今天我们要介绍一个新功能

...（时间轴已拉伸2倍）
```

#### 步骤2：视频合并

**输入**：
- video.mp4（85秒）
- dubbing_result.wav（170秒）
- adjusted_subtitles.srt（170秒）

**处理**：
- 视频慢放2倍 → 170秒
- 字幕时间轴再次调整以匹配慢放

**输出**：
- `merged_video.mp4`（170秒）

### 最终效果

```
┌─────────────────────────────────────┐
│ merged_video.mp4(170秒)            │
├─────────────────────────────────────┤
│ 画面：慢放2倍，流畅自然             │
│ 音频：日语配音，清晰完整            │
│ 字幕：时间轴准确，完美同步          │
└─────────────────────────────────────┘
```

---

## 常见问题

### Q1: 为什么视频要慢放？

**A:** 因为日语表达比中文长。如果不慢放视频：
- 画面85秒就结束了
- 但音频还要播放到170秒
- 后半段只有黑屏

慢放视频可以让画面和音频同步。

### Q2: 慢放会不会很明显？

**A:** 取决于慢放比例：
- 1.2x以下：几乎察觉不到
- 1.5x左右：稍微能感觉到，但可接受
- 2.0x以上：比较明显

建议：
- 优化翻译，减少日语长度
- 提高TTS语速（如1.2x）
- 移除原视频中的冗余画面

### Q3: 能不能不慢放视频？

**A:** 可以，但需要手动剪辑：
1. 在原视频中插入静止画面或B-roll
2. 延长视频到170秒
3. 然后再合并音频和字幕

这需要专业的视频编辑技能。

### Q4: 字幕位置和样式能调整吗？

**A:** 当前版本使用默认样式。如需自定义：
1. 使用视频编辑软件（如Premiere）
2. 导入 `merged_video.mp4`（无字幕版本）
3. 导入 `adjusted_subtitles.srt`
4. 自定义字幕样式和位置

---

## 高级技巧

### 技巧1：优化翻译减少时长差异

**原则**：日语翻译要简洁

**示例**：
```
❌ 中文：今天我们要向大家介绍一个非常实用的新功能
   日语：今日は皆様に非常に実用的な新しい機能をご紹介させていただきます

✅ 中文：今天介绍一个新功能
   日语：今日は新機能を紹介します
```

### 技巧2：调整TTS语速

如果日语音频太长，可以提高语速：

```
TTS生成语速：1.2x
```

这样可以减少最终的慢放比例。

### 技巧3：分段处理

对于长视频，可以分段处理：

1. 将视频分成多个片段
2. 每个片段单独配音和合并
3. 最后拼接所有片段

这样可以更精细地控制每段的慢放比例。

### 技巧4：使用视频编辑软件微调

1. 导出无字幕版本（不上传字幕文件）
2. 在Premiere等软件中导入
3. 手动调整部分片段的速度
4. 添加转场和特效
5. 最后烧录字幕

---

## 故障排除

### 问题1：没有生成adjusted_subtitles.srt

**原因**：
- 没有勾选"移除静音间隙"
- 音频与字幕时长差异小于10%

**解决**：
- 确保勾选"移除静音间隙"
- 检查日志中的时长信息

### 问题2：字幕时间轴不准确

**原因**：
- 使用了错误的字幕文件
- 字幕文件格式有问题

**解决**：
- 确保使用 `adjusted_subtitles.srt`
- 检查SRT文件格式是否正确

### 问题3：视频画面卡顿

**原因**：
- FFmpeg参数问题
- 视频编码问题

**解决**：
- 检查FFmpeg日志
- 尝试重新编码原视频

### 问题4：音频和画面不同步

**原因**：
- 字幕时间轴调整有误
- 视频慢放比例计算错误

**解决**：
- 查看日志中的慢放比例
- 手动验证时间轴

---

## 总结

### 核心流程

```
中文字幕(85秒)
    ↓
[TTS配音 + 移除静音间隙]
    ↓
日语音频(170秒) + 调整后字幕(170秒)
    ↓
[视频合并 + 自动慢放]
    ↓
最终视频(170秒，画面+音频+字幕完美同步)
```

### 关键设置

| 模块 | 关键选项 | 设置 |
|------|---------|------|
| TTS配音 | 移除静音间隙 | ✅ 勾选 |
| TTS配音 | 保持SRT总时长 | ❌ 不勾选 |
| TTS配音 | TTS生成语速 | 1.0x |
| 视频合并 | 合并模式 | 替换音轨并烧录字幕 |

### 输出文件

```
output/
├── dubbing_result.wav              # TTS配音
├── adjusted_subtitles.srt          # 调整后的字幕
└── merged_video.mp4                # 最终视频
```

---

## 相关文档

- [字幕自动调整功能说明](./字幕自动调整功能说明.md)
- [跨语言配音优化说明](./跨语言配音优化说明.md)
- [视频慢放同步功能说明](./视频慢放同步功能说明.md)
- [视频合并快速指南](./视频合并快速指南.md)
