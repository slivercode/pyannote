# TTS模型管理使用说明

## 🎯 功能概述

TTS模型管理模块已集成到主界面，支持 GPT-SoVITS 和 QwenTTS 两种TTS引擎的配置和测试。

## 📋 使用步骤

### 1. 打开TTS管理界面

点击导航栏右侧的 **"TTS模型管理"** 按钮，打开配置弹窗。

### 2. 配置 GPT-SoVITS

#### 2.1 启用引擎
- 点击 GPT-SoVITS 右侧的开关，启用该引擎

#### 2.2 配置API地址
```
http://192.168.110.204:9880
```

#### 2.3 添加配音角色
1. 点击 **"添加角色"** 按钮
2. 填写角色信息：
   - **角色名称**: 例如 "角色A"
   - **参考音频路径**: `cs3.mp3` (只填文件名，文件需在GPT-SoVITS服务器根目录)
   - **参考文本**: 参考音频对应的文本内容
   - **参考语言**: 选择参考音频的语言（中文/英文/日文）
   - **语速**: 调整语速（0.5-2.0，默认1.0）

#### 2.4 测试角色配置
1. 填写完角色信息后，点击 **"测试合成"** 按钮
2. 系统会：
   - 使用测试文本 "你好，这是测试文本" 进行合成
   - 显示测试状态（正在测试/成功/失败）
   - 成功后自动播放合成的音频
3. 可以点击 🔊 按钮重新播放测试音频

### 3. 配置 QwenTTS

#### 3.1 启用引擎
- 点击 QwenTTS 右侧的开关，启用该引擎

#### 3.2 配置API密钥
```
sk-xxxxxxxxxxxxxxxx
```
在阿里云DashScope控制台获取

#### 3.3 添加配音角色
1. 点击 **"添加角色"** 按钮
2. 填写：
   - **角色名称**: 例如 "龙小春"
   - **音色**: 选择预设音色（龙小春/龙小夏/龙小秋/龙小冬）

### 4. 保存配置

点击 **"保存配置"** 按钮，配置将保存到服务器的 `tts_config.json` 文件。

### 5. 其他操作

- **重新加载**: 从服务器重新加载配置
- **测试连接**: 快速测试API连接状态

## 🔧 GPT-SoVITS 配置要点

### 参考音频路径规则

**重要**: 参考音频文件必须放在 GPT-SoVITS 服务器的项目根目录！

#### 正确示例

假设 GPT-SoVITS 安装在 `/home/fuxin/GPT-SoVITS/`

1. **上传音频到服务器根目录**
   ```bash
   scp cs3.mp3 user@192.168.110.204:/home/fuxin/GPT-SoVITS/
   ```

2. **配置时只填文件名**
   ```
   参考音频路径: cs3.mp3
   ```

#### 错误示例

```
❌ D:\AI_video\cs3.mp3  (客户端本地路径)
❌ /home/fuxin/cs3.mp3  (不在GPT-SoVITS根目录)
```

### 测试功能说明

测试按钮会：
1. 使用配置的参考音频和参考文本
2. 合成测试文本 "你好，这是测试文本"
3. 返回合成的音频并自动播放

**测试状态**:
- 🟡 **正在测试**: 正在请求TTS服务
- ✅ **测试成功**: 合成成功，可以播放音频
- ❌ **测试失败**: 显示错误信息

### 常见错误及解决

#### 1. "无法连接到服务器"
- 检查 GPT-SoVITS 服务是否启动
- 检查 API 地址是否正确
- 检查网络连接

#### 2. "not exists" 错误
- 确认音频文件在 GPT-SoVITS 根目录
- 只填写文件名，不要填完整路径
- 检查文件权限

#### 3. "返回的不是音频文件"
- 检查参考文本和参考语言是否匹配
- 查看浏览器控制台的详细错误信息

## 📝 配置文件格式

配置保存在 `tts_config.json`:

```json
{
  "gptSovits": {
    "enabled": true,
    "apiUrl": "http://192.168.110.204:9880",
    "roles": [
      {
        "name": "角色A",
        "refAudioPath": "cs3.mp3",
        "promptText": "何でだよ 私たちは治療を受けに来たんだよ",
        "promptLang": "ja",
        "speedFactor": 1.0
      }
    ]
  },
  "qwenTts": {
    "enabled": false,
    "apiKey": "",
    "roles": []
  }
}
```

## 🎨 界面功能

### 角色卡片

每个角色配置卡片包含：
- ✏️ **编辑区**: 填写角色信息
- 🎮 **测试按钮**: 测试合成功能
- 🔊 **播放按钮**: 重新播放测试音频（测试成功后显示）
- 🗑️ **删除按钮**: 删除该角色
- 📊 **状态显示**: 显示测试结果

### 底部操作栏

- 💾 **保存配置**: 保存到服务器
- 🔄 **重新加载**: 从服务器加载
- 🔌 **测试连接**: 快速测试API连接

## 💡 使用技巧

1. **先测试再保存**: 配置完角色后，先点击测试按钮确认配置正确，再保存
2. **查看控制台**: 如果测试失败，按F12打开浏览器控制台查看详细错误
3. **音频格式**: 建议使用 WAV 格式，时长 3-10 秒
4. **语速调整**: 可以在 0.5-2.0 之间调整，1.0 为正常速度

## 🚀 API 调用方式

测试功能使用的是 GET 请求，参数示例：

```javascript
GET http://192.168.110.204:9880/tts?text=你好，这是测试文本&text_lang=zh&ref_audio_path=cs3.mp3&prompt_text=何でだよ&prompt_lang=ja&speed_factor=1.0
```

这与 `cs_tts_api/main.py` 中的调用方式一致。

## 📞 问题排查

如果测试失败，请检查：

1. ✅ GPT-SoVITS 服务是否正常运行
2. ✅ 参考音频文件是否在服务器根目录
3. ✅ API 地址是否正确（包括端口号）
4. ✅ 参考文本和参考语言是否匹配
5. ✅ 网络连接是否正常

查看详细错误信息：
- 浏览器控制台 (F12)
- 测试状态下方的错误提示
- GPT-SoVITS 服务器日志
